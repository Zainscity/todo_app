"""
Task Model

This module defines the Task entity with validation rules as specified in the data model.
"""
from datetime import datetime
from typing import Optional


class Task:
    """Represents a single to-do item with properties: ID, title, description, completion status."""

    def __init__(self, task_id: int, title: str, description: Optional[str] = None, completed: bool = False):
        """
        Initialize a Task instance.

        Args:
            task_id: Unique identifier for the task
            title: Task title (required, non-empty)
            description: Task description (optional)
            completed: Completion status (default: False)

        Raises:
            ValueError: If title is empty or task_id is not a positive integer
        """
        self._validate_task_id(task_id)
        self._validate_title(title)

        self.id = task_id
        self.title = title.strip()
        self.description = description if description is not None else ""
        self.completed = completed
        self.created_at = datetime.now()

    def _validate_task_id(self, task_id: int) -> None:
        """Validate that task_id is a positive integer."""
        if not isinstance(task_id, int) or task_id <= 0:
            raise ValueError(f"Task ID must be a positive integer, got {task_id}")

    def _validate_title(self, title: str) -> None:
        """Validate that title is not empty."""
        if not title or not title.strip():
            raise ValueError("Task title cannot be empty or contain only whitespace")

    def toggle_completion(self) -> None:
        """Toggle the completion status of the task."""
        self.completed = not self.completed

    def update_details(self, title: Optional[str] = None, description: Optional[str] = None) -> None:
        """
        Update task details.

        Args:
            title: New title (optional)
            description: New description (optional)

        Raises:
            ValueError: If title is provided but is empty
        """
        if title is not None:
            self._validate_title(title)
            self.title = title.strip()

        if description is not None:
            self.description = description

    def to_dict(self) -> dict:
        """Convert task to dictionary representation."""
        return {
            "id": self.id,
            "title": self.title,
            "description": self.description,
            "completed": self.completed,
            "created_at": self.created_at.isoformat()
        }

    def __str__(self) -> str:
        """String representation of the task."""
        status = "âœ“" if self.completed else "â—‹"
        return f"[{status}] ID: {self.id} | Title: {self.title} | Desc: {self.description or 'N/A'}"

    def __repr__(self) -> str:
        """Detailed string representation of the task."""
        return f"Task(id={self.id}, title='{self.title}', completed={self.completed})"